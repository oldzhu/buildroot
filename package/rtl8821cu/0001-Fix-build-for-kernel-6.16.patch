From 13f85e370c265b782a801cd22f86cea6f6cda876 Mon Sep 17 00:00:00 2001
From: Giulio Benetti <giulio.benetti@benettiengineering.com>
Date: Mon, 8 Sep 2025 21:04:30 +0200
Subject: [PATCH] Fix build for kernel 6.16

With commit:
https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=41cb08555c4164996d67c78b3bf1c658075b75f1
from_timer() has been renamed to timer_container_of() so let's rename
according to linux version >= 6.16.

Upstream: https://github.com/morrownr/8821cu-20210916/pull/187
Signed-off-by: Giulio Benetti <giulio.benetti@benettiengineering.com>
---
 include/osdep_service_linux.h | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/include/osdep_service_linux.h b/include/osdep_service_linux.h
index ed1e19b..c25f6a2 100644
--- a/include/osdep_service_linux.h
+++ b/include/osdep_service_linux.h
@@ -210,6 +210,10 @@ typedef void	*thread_context;
 typedef void timer_hdl_return;
 typedef void *timer_hdl_context;
 
+#if (LINUX_VERSION_CODE > KERNEL_VERSION(6, 16, 0))
+#define from_timer     timer_container_of
+#endif
+
 #if (LINUX_VERSION_CODE > KERNEL_VERSION(2, 5, 41))
 	typedef struct work_struct _workitem;
 #else
-- 
2.43.0

